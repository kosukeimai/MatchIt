\documentclass[oneside,letterpaper,12pt]{book}
\usepackage{bibentry}
\usepackage{graphicx}
\usepackage{natbib}
\usepackage[reqno]{amsmath}
\usepackage{amssymb}
\usepackage{verbatim}
\usepackage{epsf}
\usepackage{url}
\usepackage{html}
\usepackage{dcolumn}
\usepackage{fullpage}
\bibpunct{(}{)}{;}{a}{}{,}
\newcolumntype{.}{D{.}{.}{-1}}
\newcolumntype{d}[1]{D{.}{.}{#1}}
%\pagestyle{myheadings}
\htmladdtonavigation{
  \htmladdnormallink{%
    \htmladdimg{http://gking.harvard.edu/pics/home.gif}}
  {http://gking.harvard.edu/}}
\newcommand{\hlink}{\htmladdnormallink}

\bodytext{ BACKGROUND="http://gking.harvard.edu/pics/temple.jpg"}
\setcounter{tocdepth}{3}
\setcounter{secnumdepth}{4}

\newcommand{\MatchIt}{\textsc{MatchIt}}

\title{\MatchIt: Nonparametric Preprocessing for Parametric Causal
  Inference\thanks{We thank Olivia Lau for helpful suggestions about
    incorporating \MatchIt\, into Zelig.}}

\author{Daniel E. Ho,\thanks{Institute for Quantitative Social Science
    (1727 Cambridge Street, Cambridge MA 02138, USA;
    \texttt{http://people.iq.harvard.edu/~dho/},
    \texttt{daniel.e.ho@gmail.com}).}  \and %
  Kosuke Imai,\thanks{Assistant Professor, Department of Politics,
    Princeton University (Corwin Hall 041, Department of Politics,
    Princeton University, Princeton NJ 08544, USA;
    \texttt{http://imai.princeton.edu},
    \texttt{kimai@Princeton.Edu}).}  \and %
  Gary King,\thanks{David Florence Professor of Government, Harvard
    University (Institute for Quantitative Social Science, 1737
    Cambridge Street, Harvard University, Cambridge MA 02138;
    \texttt{http://GKing.Harvard.Edu}, \texttt{King@Harvard.Edu},
    (617) 495-2027).}  \and %
Elizabeth A. Stuart\thanks{Assistant Professor, Departments of Mental 
Health and Biostatistics, Johns Hopkins Bloomberg School of Public Health 
(624 N Broadway, Room 804, Baltimore, MD 21205; 
  \texttt{http://wwww.biostat.jhsph.edu/~estuart},
  \texttt{estuart@jhsph.edu}).}}

%\makeindex

\begin{document}
\maketitle

\begin{rawhtml}
  <p> [Also available is a downloadable <a
  href="/matchit/docs/matchit.pdf">PDF</a> version of this entire
  document]
\end{rawhtml}

\tableofcontents

\nobibliography*

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\clearpage

\chapter{Introduction}
\input{intro}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Statistical Overview}
\input{overview}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{User's Guide to \MatchIt}
\label{methods}

\input{preprocess}
\input{balance}
\input{matchit2zelig}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Reference Manual}
\label{chap:reference}

\section{\texttt{matchit()}: Implementation of Matching Methods}
\label{sec:matchit}
Use \texttt{matchit()} to implement a variety of matching procedures
including exact matching, nearest neighbor matching,
subclassification, optimal matching, genetic matching, and full
matching.  The output of {\tt matchit()} can be analyzed via any
standard R package, by exporting the data for use in another program,
or most simply via \hlink{Zelig}{http://gking.harvard.edu/zelig} in R.

\input{matchitref}
\input{summaryref}
\input{plotref}
\input{mdataref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Appendices}

\section{What's New?}

\begin{itemize}
\item \textbf{2.2-14} (September 2, 2007): Stable release for R
  2.5. Documentation improved for full matching. (Thanks to Langche Zeng)
\item \textbf{2.2-13} (April 10, 2007): Stable release for R
  2.4. Additional fix to package dependencies. Bug fix for summary().
\item \textbf{2.2-12} (April 6, 2007): Stable release for R 2.4. Fix
  to package dependencies.
\item \textbf{2.2-11} (July 13, 2006): Stable release for R 2.3.
  Fix to ensure summary() command works with character variables in dataframe (thanks to Daniel Gerlanc).
\item \textbf{2.2-10} (May 9, 2006): Stable release for R 2.3.
  A bug fix in {\tt demo(analysis)} (thanks to Julia Gray).
\item \textbf{2.2-9} (May 3, 2006): Stable release for R 2.3.
  A minor change to DESCRIPTION file.
\item \textbf{2.2-8} (May 1, 2006): Stable release for R 2.3.
  Removed dependency on Zelig (thanks to Dave Kane).
\item \textbf{2.2-7} (April 11, 2006): Stable release for R 2.2.
  Error message for missing values in the data frame added
  (thanks to Olivia Lau).
\item \textbf{2.2-6} (April 4, 2006): Stable release for R 2.2.
  Bug fixes related to {\tt reestimate} in {\tt matchit()} and {\tt
  match.data()} (thanks to Ani Ruhil and Claire Aussems). 
\item \textbf{2.2-5} (December 7, 2005): Stable release for R 2.2.
  Changed URL of {\tt WhatIf} to CRAN.
\item \textbf{2.2-4} (December 3, 2005): Stable release for R 2.2.
  User's own distance measure can be used with \MatchIt\, (thanks to
  Nelson Lim).
\item \textbf{2.2-3} (November 18, 2005): Stable release for R 2.2.
  standardize option added to full matching and subclass (thanks to
  Jeronimo Cortina).
\item \textbf{2.2-2} (November 9, 2005): Stable release for R 2.2.
  {\tt optmatch} package now on CRAN. Changed URL for that package. 
\item \textbf{2.2-1} (November 1, 2005): Stable release for R 2.2.
  balance measures based on empirical CDF are added as a new option
  {\tt standardize} in {\tt summary()}.
\item \textbf{2.1-4} (October 14, 2005): Stable release for R 2.2.
  strictly empirical (no interpolation) quantile-quantile functions
  and plots are used.
\item \textbf{2.1-3} (September 27, 2005): Stable release for R 2.1.
  automated the installation of optional packages. fixed a coding
  error in {\tt summary()}, the documentation edited.
\item \textbf{2.1-2} (September 27, 2005): Stable release for R 2.1.
  minor changes to file names, the option {\tt "whichxs"} added to the
  {\tt plot()}, major editing of the documentation.
\item \textbf{2.1-1} (September 16, 2005): Stable release for R
        2.1. Genetic matching added.    
\item \textbf{2.0-1} (August 29, 2005): Stable release for R 2.1.
  Major revisions including some syntax changes. Statistical tests are
  no longer used for balance checking, which are now based on the
  empirical covariate distributions (e.g., quantile-quantile plot).
\item \textbf{1.0-2} (August 10, 2005): Stable release for R
  2.1. Minor bug fixes (Thanks to Bart Bonikowski).
\item \textbf{1.0-1} (January 3, 2005): Stable release for R 2.0. The
  first official version of \MatchIt
\end{itemize}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Frequently Asked Questions}

\subsection{What if My datasets Are Big and Are Taking Up
  Too Much Memory?}

{\tt matchit()} does not save the data set in its output object.
However, {\tt match.data()} will create a matched data set. One can
eliminate the original data set by {\tt rm(name)} where {\tt name} is
the name of the data set after creating the matched data by {\tt
  match.data()}.

%\subsection{Can I use a Difference-in-Difference Estimator for Matched
%  Data?}
%
%A difference-in-differences (DID) analysis can be easily conducted
%with \MatchIt.  If we were interested in the DID matching estimate in
%the Lalonde data, we could simply include {\texttt re75} as a
%covariate in the preprocessing step.  Then the analysis can be
%performed on the change in income from 1975 to 1978: {\tt re78}-{\tt
%  re75}.  Time-varying covariates (of which none exist in the Lalonde
%data) should of course also be differenced for the DID estimator.
%** we should show how to do this with zelig

\subsection{How Exactly are the Weights Created?}
\label{subsec:weights}

Each type of matching method can be thought of as creating groups of
units with at least one treated unit and at least one control unit in
each.  In exact matching, subclassification, or full matching, these
groups are the subclasses formed, and the number of treated and
control units will vary quite a bit across subclasses.  In nearest
neighbor or optimal matching, the groups are the pairs (or sets) of
treated and control units matched.  In 1:1 nearest neighbor matching
there will be one treated unit and one control unit in each group.  In
2:1 nearest neighbor matching there will be one treated unit and two
control units in each group.  Unmatched units receive a weight of 0.
All matched treated units receive a weight of 1.

The weights for matched control units are formed as follows:
\begin{enumerate}
\item Within each group, each control unit is given a preliminary
  weight of $n_{ti}/n_{ci}$, where $n_{ti}$ and $n_{ci}$ are the
  number of treated and control units in group $i$, respectively.
\item If matching is done with replacement, each control unit's weight
  is added up across the groups in which it was matched.
\item The control group weights are scaled to sum to the number of
  uniquely matched control units.
\end{enumerate}

With subclassification, when the analysis is done separately within
each subclass and then aggregated up across the subclasses, these
weights will generally not be used, but they may be used for full
matching or nearest neighbor matching if the number of control units
matched to each treated unit varies.



\subsection{How Do I Create Observation Names?}
\label{rnames}

Since the diagnostics often make use of the observation names of the
data frame, you may find it helpful to specify observation names for
the data input.  Use the \texttt{row.names} command to achieve this.
For example, to assign the names ``Dan'', ``Kosuke'', ``Liz'' and
``Gary'' to a data frame with the first four observations in the
Lalonde data, type:


\begin{verbatim}
> test <- lalonde[1:4, ]
> row.names(test) <- c("Dan", "Kosuke", "Liz", "Gary")
> print(test)
       age educ black hisp married nodegr re74 re75  re78 u74 u75 treat
Dan     37   11     1    0       1      1    0    0  9930   1   1     1
Kosuke  22    9     0    1       0      1    0    0  3596   1   1     1
Liz     30   12     1    0       0      0    0    0 24910   1   1     1
Gary    27   11     1    0       0      1    0    0  7506   1   1     1
\end{verbatim}


\subsection{How Do I Ensure Replicability As \MatchIt\ Versions Develop?}
\label{subsec:vercontrol}

As the literature on matching techniques is rapidly evolving,
\MatchIt\ will strive to incorporate new developments. \MatchIt\ is
thereby an evolving program.  Users may be concerned that analysis
written in a particular version may not be compatible with newer
versions of the program.  The primary way to ensure that replication
archives remain valid is to record the version of \MatchIt\ that was
used in the analysis.  Our website maintains binaries of all public
release versions, so that researchers can replicate results exactly
with the appropriate version (for Unix-based platforms, see
\hlink{http://gking.harvard.edu/src/contrib/}{http://gking.harvard.edu/src/contrib/};
for windows, see
\hlink{http://gking.harvard.edu/bin/windows/contrib/}{http://gking.harvard.edu/bin/windows/contrib/}).

In addition, users may find it helpful to install packages with
version control, using the {\tt installWithVers} command with {\tt
install.packages}.  So for example, in the windows R console, users
may download the appropriate version from our website and install the
package with version control by:

\begin{verbatim}
install.packages(choose.files('',filters=Filters[c('zip','All'),]),
                 .libPaths()[1],installWithVers=T,CRAN=NULL)
\end{verbatim}

{\tt R CMD INSTALL} similarly permits users to specify this version
using the \\ {\tt --with-package-versions} option.  After having
specified version control, different versions of the program may be
called as necessary.  Similar advice may also be appropriate for
version control for R more generally.

\subsection{How Do I Use My Own Distance Measure with \MatchIt\,?}

A vector of your own distance measure can be used by specifying it as
the input for {\tt distance} option in {\tt matchit()}.

\subsection{What Do I Do about Missing Data?}

\MatchIt\ requires complete data sets, with no missing values (other
than potential outcomes of course).  If there are missing values in
the data set, imputation techniques should be used first to fill in
(``impute'') the missing values (both covariates and outcomes), or the
analysis should be done using only complete cases (which we do not in
general recommend).  For imputation software, see Amelia at
(\hlink{http://gking.harvard.edu/stats.shtml}{http://gking.harvard.edu/stats.shtml})
or other programs at
\hlink{http://www.multiple-imputation.com}{http://www.multiple-imputation.com}.
For more information on missing data and imputation methods, see
\cite{KinHonJos01}.

\subsection{Why Preprocessing?}

The purpose of matching is to approximate an experimental template,
where the matching procedure approximates random assignment of
treatment in order to balance covariates between treatment and control
groups.  Separation of the estimation procedure into two steps
simulates the research design of an experiment, where no information
on outcomes is known at the point of experimental design and
randomization.  Much like an experimenter cannot easily rerun an
experiment if the outcome was not satisfactory, the separation of the
balancing process in \MatchIt\ from the analysis process afterward
helps keep clear the goal of balancing control and treatment groups
and makes it less likely that the user will inadvertently cook the
books in his or her favor.

\clearpage

\bibliographystyle{asa}
\bibliography{gk,gkpubs}

\end{document}

