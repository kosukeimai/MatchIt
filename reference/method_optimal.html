<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Optimal Pair Matching — method_optimal • MatchIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal Pair Matching — method_optimal"><meta name="description" content='In matchit(), setting method = "optimal" performs optimal pair
matching. The matching is optimal in the sense that that sum of the absolute
pairwise distances in the matched sample is as small as possible. The method
functionally relies on optmatch::fullmatch().
Advantages of optimal pair matching include that the matching order is not
required to be specified and it is less likely that extreme within-pair
distances will be large, unlike with nearest neighbor matching. Generally,
however, as a subset selection method, optimal pair matching tends to
perform similarly to nearest neighbor matching in that similar subsets of
units will be selected to be matched.
This page details the allowable arguments with method = "optmatch".
See matchit() for an explanation of what each argument means in a general
context and how it can be specified.
Below is how matchit() is used for optimal pair matching:
matchit(formula,
        data = NULL,
        method = "optimal",
        distance = "glm",
        link = "logit",
        distance.options = list(),
        estimand = "ATT",
        exact = NULL,
        mahvars = NULL,
        antiexact = NULL,
        discard = "none",
        reestimate = FALSE,
        s.weights = NULL,
        ratio = 1,
        min.controls = NULL,
        max.controls = NULL,
        verbose = FALSE,
        ...)
'><meta property="og:description" content='In matchit(), setting method = "optimal" performs optimal pair
matching. The matching is optimal in the sense that that sum of the absolute
pairwise distances in the matched sample is as small as possible. The method
functionally relies on optmatch::fullmatch().
Advantages of optimal pair matching include that the matching order is not
required to be specified and it is less likely that extreme within-pair
distances will be large, unlike with nearest neighbor matching. Generally,
however, as a subset selection method, optimal pair matching tends to
perform similarly to nearest neighbor matching in that similar subsets of
units will be selected to be matched.
This page details the allowable arguments with method = "optmatch".
See matchit() for an explanation of what each argument means in a general
context and how it can be specified.
Below is how matchit() is used for optimal pair matching:
matchit(formula,
        data = NULL,
        method = "optimal",
        distance = "glm",
        link = "logit",
        distance.options = list(),
        estimand = "ATT",
        exact = NULL,
        mahvars = NULL,
        antiexact = NULL,
        discard = "none",
        reestimate = FALSE,
        s.weights = NULL,
        ratio = 1,
        min.controls = NULL,
        max.controls = NULL,
        verbose = FALSE,
        ...)
'><meta property="og:image" content="https://kosukeimai.github.io/MatchIt/logo.png"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css" integrity="sha384-zh0CIslj+VczCZtlzBcjt5ppRcsAmDnRem7ESsYwWwg3m/OaJ2l4x7YBZl9Kxxib" crossorigin="anonymous"><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js" integrity="sha384-Rma6DA2IPUwhNxmrB/7S3Tno0YY7sFu9WSYMCuulLhIqYSGZ2gKCJWIqhBWqMQfh" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MatchIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/matching-methods.html">Matching Methods</a></li>
    <li><a class="dropdown-item" href="../articles/assessing-balance.html">Assessing Balance</a></li>
    <li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Matching</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-weights.html">Matching with Sampling Weights</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kosukeimai/MatchIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Optimal Pair Matching</h1>
      <small class="dont-index">Source: <a href="https://github.com/kosukeimai/MatchIt/blob/master/R/matchit2optimal.R" class="external-link"><code>R/matchit2optimal.R</code></a></small>
      <div class="d-none name"><code>method_optimal.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>In <code><a href="matchit.html">matchit()</a></code>, setting <code>method = "optimal"</code> performs optimal pair
matching. The matching is optimal in the sense that that sum of the absolute
pairwise distances in the matched sample is as small as possible. The method
functionally relies on <code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code>.</p>
<p>Advantages of optimal pair matching include that the matching order is not
required to be specified and it is less likely that extreme within-pair
distances will be large, unlike with nearest neighbor matching. Generally,
however, as a subset selection method, optimal pair matching tends to
perform similarly to nearest neighbor matching in that similar subsets of
units will be selected to be matched.</p>
<p>This page details the allowable arguments with <code>method = "optmatch"</code>.
See <code><a href="matchit.html">matchit()</a></code> for an explanation of what each argument means in a general
context and how it can be specified.</p>
<p>Below is how <code><a href="matchit.html">matchit()</a></code> is used for optimal pair matching:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="fu"><a href="../reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">formula</span>,</span>
<span>        data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        method <span class="op">=</span> <span class="st">"optimal"</span>,</span>
<span>        distance <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>        link <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>        distance.options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>        exact <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        mahvars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        antiexact <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        discard <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>        reestimate <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        s.weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        min.controls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        max.controls <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>        verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        <span class="va">...</span><span class="op">)</span> </span></code></pre></div>

    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a two-sided <a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a> object containing the treatment and
covariates to be used in creating the distance measure used in the matching.
This formula will be supplied to the functions that estimate the distance
measure.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>a data frame containing the variables named in <code>formula</code>.
If not found in <code>data</code>, the variables will be sought in the
environment.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>set here to <code>"optimal"</code>.</p></dd>


<dt id="arg-distance">distance<a class="anchor" aria-label="anchor" href="#arg-distance"></a></dt>
<dd><p>the distance measure to be used. See <code><a href="distance.html">distance</a></code>
for allowable options. Can be supplied as a distance matrix.</p></dd>


<dt id="arg-link">link<a class="anchor" aria-label="anchor" href="#arg-link"></a></dt>
<dd><p>when <code>distance</code> is specified as a method of estimating
propensity scores, an additional argument controlling the link function used
in estimating the distance measure. See <code><a href="distance.html">distance</a></code> for allowable
options with each option.</p></dd>


<dt id="arg-distance-options">distance.options<a class="anchor" aria-label="anchor" href="#arg-distance-options"></a></dt>
<dd><p>a named list containing additional arguments
supplied to the function that estimates the distance measure as determined
by the argument to <code>distance</code>.</p></dd>


<dt id="arg-estimand">estimand<a class="anchor" aria-label="anchor" href="#arg-estimand"></a></dt>
<dd><p>a string containing the desired estimand. Allowable options
include <code>"ATT"</code> and <code>"ATC"</code>. See Details.</p></dd>


<dt id="arg-exact">exact<a class="anchor" aria-label="anchor" href="#arg-exact"></a></dt>
<dd><p>for which variables exact matching should take place.</p></dd>


<dt id="arg-mahvars">mahvars<a class="anchor" aria-label="anchor" href="#arg-mahvars"></a></dt>
<dd><p>for which variables Mahalanobis distance matching should take
place when <code>distance</code> corresponds to a propensity score (e.g., for
caliper matching or to discard units for common support). If specified, the
distance measure will not be used in matching.</p></dd>


<dt id="arg-antiexact">antiexact<a class="anchor" aria-label="anchor" href="#arg-antiexact"></a></dt>
<dd><p>for which variables anti-exact matching should take place.
Anti-exact matching is processed using <code><a href="https://rdrr.io/pkg/optmatch/man/antiExactMatch.html" class="external-link">optmatch::antiExactMatch()</a></code>.</p></dd>


<dt id="arg-discard">discard<a class="anchor" aria-label="anchor" href="#arg-discard"></a></dt>
<dd><p>a string containing a method for discarding units outside a
region of common support. Only allowed when <code>distance</code> is not
<code>"mahalanobis"</code> and not a matrix.</p></dd>


<dt id="arg-reestimate">reestimate<a class="anchor" aria-label="anchor" href="#arg-reestimate"></a></dt>
<dd><p>if <code>discard</code> is not <code>"none"</code>, whether to
re-estimate the propensity score in the remaining sample prior to matching.</p></dd>


<dt id="arg-s-weights">s.weights<a class="anchor" aria-label="anchor" href="#arg-s-weights"></a></dt>
<dd><p>the variable containing sampling weights to be incorporated
into propensity score models and balance statistics.</p></dd>


<dt id="arg-ratio">ratio<a class="anchor" aria-label="anchor" href="#arg-ratio"></a></dt>
<dd><p>how many control units should be matched to each treated unit
for k:1 matching. For variable ratio matching, see section "Variable Ratio
Matching" in Details below.</p></dd>


<dt id="arg-min-controls-max-controls">min.controls, max.controls<a class="anchor" aria-label="anchor" href="#arg-min-controls-max-controls"></a></dt>
<dd><p>for variable ratio matching, the minimum
and maximum number of controls units to be matched to each treated unit. See
section "Variable Ratio Matching" in Details below.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><code>logical</code>; whether information about the matching
process should be printed to the console. What is printed depends on the
matching method. Default is <code>FALSE</code> for no printing other than
warnings.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments passed to <code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code>.
Allowed arguments include <code>tol</code> and <code>solver</code>. See the
<code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code> documentation for details. In general, <code>tol</code>
should be set to a low number (e.g., <code>1e-7</code>) to get a more precise
solution (default is <code>1e-3</code>).</p>
<p>The arguments <code>replace</code>, <code>caliper</code>, and <code>m.order</code> are ignored with a warning.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="mahalanobis-distance-matching">Mahalanobis Distance Matching<a class="anchor" aria-label="anchor" href="#mahalanobis-distance-matching"></a></h3>


<p>Mahalanobis distance matching can be done one of two ways:</p><ol><li><p>If no propensity score needs to be estimated, <code>distance</code> should be
set to <code>"mahalanobis"</code>, and Mahalanobis distance matching will occur
using all the variables in <code>formula</code>. Arguments to <code>discard</code> and
<code>mahvars</code> will be ignored. For example, to perform simple Mahalanobis
distance matching, the following could be run:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="fu"><a href="../reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, method <span class="op">=</span> <span class="st">"nearest"</span>,</span>
<span>        distance <span class="op">=</span> <span class="st">"mahalanobis"</span><span class="op">)</span> </span></code></pre></div>With this code, the Mahalanobis distance is computed using <code>X1</code> and
<code>X2</code>, and matching occurs on this distance. The <code>distance</code>
component of the <code><a href="matchit.html">matchit()</a></code> output will be empty.</li>
<li><p>If a propensity score needs to be estimated for common support with
<code>discard</code>, <code>distance</code> should be whatever method is used to
estimate the propensity score or a vector of distance measures, i.e., it
should not be <code>"mahalanobis"</code>. Use <code>mahvars</code> to specify the
variables used to create the Mahalanobis distance. For example, to perform
Mahalanobis after discarding units outside the common support of the
propensity score in both groups, the following could be run:</p><div class="sourceCode"><pre><code><span></span>
<span><span class="fu"><a href="../reference/matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span> <span class="op">+</span> <span class="va">X3</span>, method <span class="op">=</span> <span class="st">"nearest"</span>,</span>
<span>        distance <span class="op">=</span> <span class="st">"glm"</span>, discard <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>        mahvars <span class="op">=</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span><span class="op">)</span> </span></code></pre></div>With this code, <code>X1</code>, <code>X2</code>, and <code>X3</code> are used to estimate the
propensity score (using the <code>"glm"</code> method, which by default is
logistic regression), which is used to identify the common support. The
actual matching occurs on the Mahalanobis distance computed only using
<code>X1</code> and <code>X2</code>, which are supplied to <code>mahvars</code>. The estimated
propensity scores will be included in the <code>distance</code> component of the
<code><a href="matchit.html">matchit()</a></code> output.</li>
</ol></div>

<div class="section">
<h3 id="estimand">Estimand<a class="anchor" aria-label="anchor" href="#estimand"></a></h3>


<p>The <code>estimand</code> argument controls whether control units are selected to be matched with treated units
(<code>estimand = "ATT"</code>) or treated units are selected to be matched with
control units (<code>estimand = "ATC"</code>). The "focal" group (e.g., the
treated units for the ATT) is typically made to be the smaller treatment
group, and a warning will be thrown if it is not set that. Setting <code>estimand = "ATC"</code> is equivalent to
swapping all treated and control labels for the treatment variable. When
<code>estimand = "ATC"</code>, the <code>match.matrix</code> component of the output
will have the names of the control units as the rownames and be filled with
the names of the matched treated units (opposite to when <code>estimand = "ATT"</code>). Note that the argument supplied to <code>estimand</code> doesn't
necessarily correspond to the estimand actually targeted; it is merely a
switch to trigger which treatment group is considered "focal".</p>
</div>

<div class="section">
<h3 id="variable-ratio-matching">Variable Ratio Matching<a class="anchor" aria-label="anchor" href="#variable-ratio-matching"></a></h3>


<p><code><a href="matchit.html">matchit()</a></code> can perform variable
ratio matching, which involves matching a different number of control units
to each treated unit. When <code>ratio &gt; 1</code>, rather than requiring all
treated units to receive <code>ratio</code> matches, the arguments to
<code>max.controls</code> and <code>min.controls</code> can be specified to control the
maximum and minimum number of matches each treated unit can have.
<code>ratio</code> controls how many total control units will be matched: <code>n1 * ratio</code> control
units will be matched, where <code>n1</code> is the number of
treated units, yielding the same total number of matched controls as fixed
ratio matching does.</p>
<p>Variable ratio matching can be used with any <code>distance</code> specification.
<code>ratio</code> does not have to be an integer but must be greater than 1 and
less than <code>n0/n1</code>, where <code>n0</code> and <code>n1</code> are the number of
control and treated units, respectively. Setting <code>ratio = n0/n1</code>
performs a restricted form of full matching where all control units are
matched. If <code>min.controls</code> is not specified, it is set to 1 by default.
<code>min.controls</code> must be less than <code>ratio</code>, and <code>max.controls</code>
must be greater than <code>ratio</code>. See the Examples section of
<code><a href="method_nearest.html">method_nearest()</a></code> for an example of their use, which is the same
as it is with optimal matching.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Optimal pair matching is a restricted form of optimal full matching
where the number of treated units in each subclass is equal to 1, whereas in
unrestricted full matching, multiple treated units can be assigned to the
same subclass. <code><a href="https://rdrr.io/pkg/optmatch/man/pairmatch.html" class="external-link">optmatch::pairmatch()</a></code> is simply a wrapper for
<code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code>, which performs optimal full matching and is the
workhorse for <code><a href="method_full.html">method_full</a></code>. In the same way, <code><a href="matchit.html">matchit()</a></code>
uses <code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code> under the hood, imposing the restrictions that
make optimal full matching function like optimal pair matching (which is
simply to set <code>min.controls &gt;= 1</code> and to pass <code>ratio</code> to the
<code>mean.controls</code> argument). This distinction is not important for
regular use but may be of interest to those examining the source code.</p>
<p>The option <code>"optmatch_max_problem_size"</code> is automatically set to
<code>Inf</code> during the matching process, different from its default in
<em>optmatch</em>. This enables matching problems of any size to be run, but
may also let huge, infeasible problems get through and potentially take a
long time or crash R. See <code><a href="https://rdrr.io/pkg/optmatch/man/setMaxProblemSize.html" class="external-link">optmatch::setMaxProblemSize()</a></code> for more details.</p>
<p>A preprocessing algorithm describe by Sävje (2020; <a href="https://doi.org/10.1214/19-STS739" class="external-link">doi:10.1214/19-STS739</a>
) is used to improve the speed of the matching when 1:1 matching on a propensity score. It does so by adding an additional constraint that guarantees a solution as optimal as the solution that would have been found without the constraint, and that constraint often dramatically reduces the size of the matching problem at no cost. However, this may introduce differences between the results obtained by <em>MatchIt</em> and by <em>optmatch</em>, though such differences will shrink when smaller values of <code>tol</code> are used.</p>
    </div>
    <div class="section level2">
    <h2 id="outputs">Outputs<a class="anchor" aria-label="anchor" href="#outputs"></a></h2>



<p>All outputs described in <code><a href="matchit.html">matchit()</a></code> are returned with
<code>method = "optimal"</code>. When <code>include.obj = TRUE</code> in the call to
<code><a href="matchit.html">matchit()</a></code>, the output of the call to <code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code> will be
included in the output. When <code>exact</code> is specified, this will be a list
of such objects, one for each stratum of the <code>exact</code> variables.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>In a manuscript, be sure to cite the following paper if using
<code><a href="matchit.html">matchit()</a></code> with <code>method = "optimal"</code>:</p>
<p>Hansen, B. B., &amp; Klopfer, S. O. (2006). Optimal Full Matching and Related
Designs via Network Flows. Journal of Computational and Graphical
Statistics, 15(3), 609–627. <a href="https://doi.org/10.1198/106186006X137047" class="external-link">doi:10.1198/106186006X137047</a></p>
<p>For example, a sentence might read:</p>
<p><em>Optimal pair matching was performed using the MatchIt package (Ho,
Imai, King, &amp; Stuart, 2011) in R, which calls functions from the optmatch
package (Hansen &amp; Klopfer, 2006).</em></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="matchit.html">matchit()</a></code> for a detailed explanation of the inputs and outputs of
a call to <code><a href="matchit.html">matchit()</a></code>.</p>
<p><code><a href="https://rdrr.io/pkg/optmatch/man/fullmatch.html" class="external-link">optmatch::fullmatch()</a></code>, which is the workhorse.</p>
<p><code><a href="method_full.html">method_full</a></code> for optimal full matching, of which optimal pair
matching is a special case, and which relies on similar machinery.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#1:1 optimal PS matching with exact matching on race</span></span></span>
<span class="r-in"><span><span class="va">m.out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  method <span class="op">=</span> <span class="st">"optimal"</span>,</span></span>
<span class="r-in"><span>                  exact <span class="op">=</span> <span class="op">~</span><span class="va">race</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Fewer control units than treated units in some `exact` strata; not all</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> treated units will get a match.</span>
<span class="r-in"><span><span class="va">m.out1</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `matchit` object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: 1:1 optimal pair matching</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - distance: Propensity score</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              - estimated with logistic regression</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614 (original), 232 (matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - target estimand: ATT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, race, nodegree, married, re74, re75</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.out1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matchit(formula = treat ~ age + educ + race + nodegree + married + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re74 + re75, data = lalonde, method = "optimal", exact = ~race)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for All Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance          0.5774        0.1822          1.7941     0.9211    0.3774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.8162       28.0303         -0.3094     0.4400    0.0813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.3459       10.2354          0.0550     0.4959    0.0347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.8432        0.2028          1.7615          .    0.6404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0595        0.1422         -0.3498          .    0.0827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.0973        0.6550         -1.8819          .    0.5577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.7081        0.5967          0.2450          .    0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.1892        0.5128         -0.8263          .    0.3236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2095.5737     5619.2365         -0.7211     0.5181    0.2248</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1532.0553     2466.4844         -0.2903     0.9563    0.1342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance     0.6444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.1577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.6404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.5577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.3236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.4470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.2876</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for Matched Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance          0.4972        0.4901          0.0325     1.0026    0.0056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.7845       25.9569         -0.0241     0.4984    0.0711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.0948       10.3966         -0.1501     0.6260    0.0286</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.7500        0.7500          0.0000          .    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0948        0.0948          0.0000          .    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.1552        0.1552          0.0000          .    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.6810        0.6121          0.1517          .    0.0690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.2414        0.2672         -0.0660          .    0.0259</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2862.5644     3046.0687         -0.0376     1.4317    0.0569</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1785.7677     1873.2021         -0.0272     1.6241    0.0506</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max Std. Pair Dist.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance     0.0776          0.0436</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.2069          1.2024</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.0776          1.1705</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.0000          0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0000          0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.0000          0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.0690          0.9102</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.0259          0.5503</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.2759          0.7299</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.1379          0.8456</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All           429     185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matched       116     116</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unmatched     313      69</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Discarded       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#2:1 optimal matching on the scaled Euclidean distance</span></span></span>
<span class="r-in"><span><span class="va">m.out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  method <span class="op">=</span> <span class="st">"optimal"</span>,</span></span>
<span class="r-in"><span>                  ratio <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="st">"scaled_euclidean"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">m.out2</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> A `matchit` object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - method: 2:1 optimal pair matching</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - distance: Scaled Euclidean - number of obs.: 614 (original), 555 (matched)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - target estimand: ATT</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, race, nodegree, married, re74, re75</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.out2</span>, un <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matchit(formula = treat ~ age + educ + race + nodegree + married + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re74 + re75, data = lalonde, method = "optimal", distance = "scaled_euclidean", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     ratio = 2)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for Matched Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.8162       26.4757         -0.0922     0.4947    0.0658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.3459       10.2730          0.0363     0.5810    0.0286</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.8432        0.2351          1.6726          .    0.6081</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0595        0.1216         -0.2629          .    0.0622</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.0973        0.6432         -1.8422          .    0.5459</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.7081        0.6243          0.1843          .    0.0838</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.1892        0.4432         -0.6487          .    0.2541</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2095.5737     4120.1633         -0.4143     0.7972    0.1577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1532.0553     2107.1613         -0.1786     1.0608    0.0935</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max Std. Pair Dist.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.1405          0.5477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.0865          0.3750</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.6081          1.6726</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0622          0.2629</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.5459          1.8422</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.0838          0.1843</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.2541          0.6487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.4081          0.4806</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.2595          0.3195</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All           429     185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matched       370     185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unmatched      59       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Discarded       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Ho, Kosuke Imai, Gary King, Elizabeth Stuart, Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

