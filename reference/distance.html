<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Propensity scores and other distance measures — distance • MatchIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Propensity scores and other distance measures — distance"><meta property="og:description" content="Several matching methods require or can involve the distance between treated and control units. Options include the Mahalanobis distance, propensity score distance, or distance between user-supplied values. Propensity scores are also used for common support via the discard options and for defining calipers. This page documents the options that can be supplied to the distance argument to matchit()."><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MatchIt</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">4.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/MatchIt.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/matching-methods.html">Matching Methods</a>
    </li>
    <li>
      <a href="../articles/assessing-balance.html">Assessing Balance</a>
    </li>
    <li>
      <a href="../articles/estimating-effects.html">Estimating Effects After Matching</a>
    </li>
    <li>
      <a href="../articles/sampling-weights.html">Matching with Sampling Weights</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kosukeimai/MatchIt/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Propensity scores and other distance measures</h1>
    
    <div class="hidden name"><code>distance.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Several matching methods require or can involve the distance between treated and control units. Options include the Mahalanobis distance, propensity score distance, or distance between user-supplied values. Propensity scores are also used for common support via the <code>discard</code> options and for defining calipers. This page documents the options that can be supplied to the <code>distance</code> argument to <code><a href="matchit.html">matchit()</a></code>.</p>
    </div>


    <div id="allowable-options">
    <h2>Allowable options</h2>
    <p>There are four ways to specify the <code>distance</code> argument: 1) as a string containing the name of a method for estimating propensity scores, 2) as a string containing the name of a method for computing pairwise distances from the covariates, 3) as a vector of values whose pairwise differences define the distance between units, or 4) as a distance matrix containing all pairwise distances. The options are detailed below.</p>
<div class="section">
<h3 id="propensity-score-estimation-methods">Propensity score estimation methods<a class="anchor" aria-label="anchor" href="#propensity-score-estimation-methods"></a></h3>
<p>When <code>distance</code> is specified as the name of a method for estimating propensity scores (described below), a propensity score is estimated using the variables in <code>formula</code> and the method corresponding to the given argument. This propensity score can be used to compute the distance between units as the absolute difference between the propensity scores of pairs of units. Propensity scores can also be used to create calipers and common support restrictions, whether or not they are used in the actual distance measure used in the matching, if any.</p>
<p>In addition to the <code>distance</code> argument, two other arguments can be specified that relate to the estimation and manipulation of the propensity scores. The <code>link</code> argument allows for different links to be used in models that require them such as generalized linear models, for which the logit and probit links are allowed, among others. In addition to specifying the link, the <code>link</code> argument can be used to specify whether the propensity score or the linearized version of the propensity score should be used; by specifying <code>link = "linear.{link}"</code>, the linearized version will be used.</p>
<p>The <code>distance.options</code> argument can also be specified, which should be a list of values passed to the propensity score-estimating function, for example, to choose specific options or tuning parameters for the estimation method. If <code>formula</code>, <code>data</code>, or <code>verbose</code> are not supplied to <code>distance.options</code>, the corresponding arguments from <code><a href="matchit.html">matchit()</a></code> will be automatically supplied. See the Examples for demonstrations of the uses of <code>link</code> and <code>distance.options</code>. When <code>s.weights</code> is supplied in the call to <code><a href="matchit.html">matchit()</a></code>, it will automatically be passed to the propensity score-estimating function as the <code>weights</code> argument unless otherwise described below.</p>
<p>The following methods for estimating propensity scores are allowed:</p>
<dl><dt><code>"glm"</code></dt>
<dd><p>The propensity scores are estimated using a generalized linear model (e.g., logistic regression). The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, and <code><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">predict.glm()</a></code> is used to compute the propensity scores. The <code>link</code> argument can be specified as a link function supplied to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, e.g., <code>"logit"</code>, which is the default. When <code>link</code> is prepended by <code>"linear."</code>, the linear predictor is used instead of the predicted probabilities. <code>distance = "glm"</code> with <code>link = "logit"</code> (logistic regression) is the default in <code><a href="matchit.html">matchit()</a></code>.</p></dd>

  <dt><code>"gam"</code></dt>
<dd><p>The propensity scores are estimated using a generalized additive model. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code>, and <code><a href="https://rdrr.io/pkg/mgcv/man/predict.gam.html" class="external-link">mgcv::predict.gam()</a></code> is used to compute the propensity scores. The <code>link</code> argument can be specified as a link function supplied to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, e.g., <code>"logit"</code>, which is the default. When <code>link</code> is prepended by <code>"linear."</code>, the linear predictor is used instead of the predicted probabilities. Note that unless the smoothing functions <code><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">mgcv::s()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">mgcv::te()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/te.html" class="external-link">mgcv::ti()</a></code>, or <code><a href="https://rdrr.io/pkg/mgcv/man/t2.html" class="external-link">mgcv::t2()</a></code> are used in <code>formula</code>, a generalized additive model is identical to a generalized linear model and will estimate the same propensity scores as <code>glm</code>. See the documentation for <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">mgcv::gam()</a></code>, <code><a href="https://rdrr.io/pkg/mgcv/man/formula.gam.html" class="external-link">mgcv::formula.gam()</a></code>, and <code><a href="https://rdrr.io/pkg/mgcv/man/gam.models.html" class="external-link">mgcv::gam.models()</a></code> for more information on how to specify these models. Also note that the formula returned in the <code><a href="matchit.html">matchit()</a></code> output object will be a simplified version of the supplied formula with smoothing terms removed (but all named variables present).</p></dd>

  <dt><code>"gbm"</code></dt>
<dd><p>The propensity scores are estimated using a generalized boosted model. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm::gbm()</a></code>, and <code><a href="https://rdrr.io/pkg/gbm/man/predict.gbm.html" class="external-link">gbm::predict.gbm()</a></code> is used to compute the propensity scores. The optimal tree is chosen using 5-fold cross-validation by default, and this can be changed by supplying an argument to <code>method</code> to <code>distance.options</code>; see <code><a href="https://rdrr.io/pkg/gbm/man/gbm.perf.html" class="external-link">gbm::gbm.perf()</a></code> for details. The <code>link</code> argument can be specified as <code>"linear"</code> to use the linear predictor instead of the predicted probabilities. No other links are allowed. The tuning parameter defaults differ from <code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm::gbm()</a></code>; they are as follows: <code>n.trees = 1e4</code>, <code>interaction.depth = 3</code>, <code>shrinkage = .01</code>, <code>bag.fraction = 1</code>, <code>cv.folds = 5</code>, <code>keep.data = FALSE</code>. These are the same defaults as used in <span class="pkg">WeightIt</span> and <span class="pkg">twang</span>, except for <code>cv.folds</code> and <code>keep.data</code>. Note this is not the same use of generalized boosted modeling as in <span class="pkg">twang</span>; here, the number of trees is chosen based on cross-validation or out-of-bag error, rather than based on optimizing balance. <span class="pkg">twang</span> should not be cited when using this method to estimate propensity scores.</p></dd>

  <dt><code>"lasso"</code>, <code>"ridge"</code>, <code>"elasticnet"</code></dt>
<dd><p>The propensity scores are estimated using a lasso, ridge, or elastic net model, respectively. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is processed with <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> and passed to <code><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html" class="external-link">glmnet::cv.glmnet()</a></code>, and <code><a href="https://glmnet.stanford.edu/reference/predict.cv.glmnet.html" class="external-link">glmnet::predict.cv.glmnet()</a></code> is used to compute the propensity scores. The <code>link</code> argument can be specified as a link function supplied to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, e.g., <code>"logit"</code>, which is the default. When <code>link</code> is prepended by <code>"linear."</code>, the linear predictor is used instead of the predicted probabilities. When <code>link = "log"</code>, a Poisson model is used. For <code>distance = "elasticnet"</code>, the <code>alpha</code> argument, which controls how to prioritize the lasso and ridge penalties in the elastic net, is set to .5 by default and can be changed by supplying an argument to <code>alpha</code> in <code>distance.options</code>. For <code>"lasso"</code> and <code>"ridge"</code>, <code>alpha</code> is set to 1 and 0, respectively, and cannot be changed. The <code>cv.glmnet()</code> defaults are used to select the tuning parameters and generate predictions and can be modified using <code>distance.options</code>. If the <code>s</code> argument is passed to <code>distance.options</code>, it will be passed to <code>predict.cv.glmnet()</code>. Note that because there is a random component to choosing the tuning parameter, results will vary across runs unless a <a href="https://rdrr.io/r/base/Random.html" class="external-link">seed</a> is set.</p></dd>

  <dt><code>"rpart"</code></dt>
<dd><p>The propensity scores are estimated using a classification tree. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code>, and <code><a href="https://rdrr.io/pkg/rpart/man/predict.rpart.html" class="external-link">rpart::predict.rpart()</a></code> is used to compute the propensity scores. The <code>link</code> argument is ignored, and predicted probabilities are always returned as the distance measure.</p></dd>

  <dt><code>"randomforest"</code></dt>
<dd><p>The propensity scores are estimated using a random forest. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html" class="external-link">randomForest::randomForest()</a></code>, and <code><a href="https://rdrr.io/pkg/randomForest/man/predict.randomForest.html" class="external-link">randomForest::predict.randomForest()</a></code> is used to compute the propensity scores. The <code>link</code> argument is ignored, and predicted probabilities are always returned as the distance measure.<!-- % When \code{s.weights} is supplied to \code{matchit()}, it will not be passed to \code{randomForest} because \code{randomForest} does not accept weights. --></p></dd>

  <dt><code>"nnet"</code></dt>
<dd><p>The propensity scores are estimated using a single-hidden-layer neural network. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/nnet/man/nnet.html" class="external-link">nnet::nnet()</a></code>, and <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> is used to compute the propensity scores. The <code>link</code> argument is ignored, and predicted probabilities are always returned as the distance measure. An argument to <code>size</code> must be supplied to <code>distance.options</code> when using <code>method = "nnet"</code>.</p></dd>

  <dt><code>"cbps"</code></dt>
<dd><p>The propensity scores are estimated using the covariate balancing propensity score (CBPS) algorithm, which is a form of logistic regression where balance constraints are incorporated to a generalized method of moments estimation of of the model coefficients. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/CBPS/man/CBPS.html" class="external-link">CBPS::CBPS()</a></code>, and <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></code> is used to compute the propensity scores. The <code>link</code> argument can be specified as <code>"linear"</code> to use the linear predictor instead of the predicted probabilities. No other links are allowed. The <code>estimand</code> argument supplied to <code><a href="matchit.html">matchit()</a></code> will be used to select the appropriate estimand for use in defining the balance constraints, so no argument needs to be supplied to <code>ATT</code> in <code>CBPS</code>.</p></dd>

  <dt><code>"bart"</code></dt>
<dd><p>The propensity scores are estimated using Bayesian additive regression trees (BART). The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/pkg/dbarts/man/bart.html" class="external-link">dbarts::bart2()</a></code>, and <code>dbarts::fitted()</code> is used to compute the propensity scores. The <code>link</code> argument can be specified as <code>"linear"</code> to use the linear predictor instead of the predicted probabilities. When <code>s.weights</code> is supplied to <code><a href="matchit.html">matchit()</a></code>, it will not be passed to <code>bart2</code> because the <code>weights</code> argument in <code>bart2</code> does not correspond to sampling weights.</p></dd>


</dl></div>

<div class="section">
<h3 id="methods-for-computing-distances-from-covariates">Methods for computing distances from covariates<a class="anchor" aria-label="anchor" href="#methods-for-computing-distances-from-covariates"></a></h3>
<p>The following methods involve computing a distance matrix from the covariates themselves without estimating a propensity score. Calipers on the distance measure and common support restrictions cannot be used, and the <code>distance</code> component of the output object will be empty because no propensity scores are estimated. The <code>link</code> and <code>distance.options</code> arguments are ignored with these methods. See the individual matching methods pages for whether these distances are allowed and how they are used. Each of these distance measures can also be calculated outside <code><a href="matchit.html">matchit()</a></code> using its <a href="euclidean_dist.html">corresponding function</a>.</p>
<dl><dt><code>"euclidean"</code></dt>
<dd><p>The Euclidean distance is the raw distance between units, computed as
$$d_{ij} = \sqrt{(x_i - x_j)(x_i - x_j)'}$$
It is sensitive to the scale of the covariates, so covariates with larger scales will take higher priority.</p></dd>

  <dt><code>"scaled_euclidean"</code></dt>
<dd><p>The scaled Euclidean distance is the Euclidean distance computed on the scaled (i.e., standardized) covariates. This ensures the covariates are on the same scale. The covariates are standardized using the pooled within-group standard deviations, computed by treatment group-mean centering each covariate before computing the standard deviation in the full sample.</p></dd>

  <dt><code>"mahalanobis"</code></dt>
<dd><p>The Mahalanobis distance is computed as
$$d_{ij} = \sqrt{(x_i - x_j)\Sigma^{-1}(x_i - x_j)'}$$
where \(\Sigma\) is the pooled within-group covariance matrix of the covariates, computed by treatment group-mean centering each covariate before computing the covariance in the full sample. This ensures the variables are on the same scale and accounts for the correlation between covariates.</p></dd>

  <dt><code>"robust_mahalanobis"</code></dt>
<dd><p>The robust rank-based Mahalanobis distance is the Mahalanobis distance computed on the ranks of the covariates with an adjustment for ties. It is described in Rosenbaum (2010, ch. 8) as an alternative to the Mahalanobis distance that handles outliers and rare categories better than the standard Mahalanobis distance but is not affinely invariant.</p></dd>


</dl><p>To perform Mahalanobis distance matching <em>and</em> estimate propensity scores to be used for a purpose other than matching, the <code>mahvars</code> argument should be used along with a different specification to <code>distance</code>. See the individual matching method pages for details on how to use <code>mahvars</code>.</p>
</div>

<div class="section">
<h3 id="distances-supplied-as-a-numeric-vector-or-matrix">Distances supplied as a numeric vector or matrix<a class="anchor" aria-label="anchor" href="#distances-supplied-as-a-numeric-vector-or-matrix"></a></h3>
<p><code>distance</code> can also be supplied as a numeric vector whose values will be taken to function like propensity scores; their pairwise difference will define the distance between units. This might be useful for supplying propensity scores computed outside <code><a href="matchit.html">matchit()</a></code> or resupplying <code><a href="matchit.html">matchit()</a></code> with propensity scores estimated previously without having to recompute them.</p>
<p><code>distance</code> can also be supplied as a matrix whose values represent the pairwise distances between units. The matrix should either be a square, with a row and column for each unit (e.g., as the output of a call to <code>as.matrix(<a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a>(.))</code>), or have as many rows as there are treated units and as many columns as there are control units (e.g., as the output of a call to <code><a href="euclidean_dist.html">mahalanobis_dist()</a></code> or <code><a href="https://markmfredrickson.github.io/optmatch/reference/match_on-methods.html" class="external-link">optmatch::match_on()</a></code>). Distance values of <code>Inf</code> will disallow the corresponding units to be matched. When <code>distance</code> is a supplied as a numeric vector or matrix, <code>link</code> and <code>distance.options</code> are ignored.</p>
</div>

    </div>
    <div id="outputs">
    <h2>Outputs</h2>
    <p>When specifying an argument to <code>distance</code> that estimates a propensity score, the output of the function called to estimate the propensity score (e.g., the <code>glm</code> object when <code>distance = "glm"</code>) will be included in the <code><a href="matchit.html">matchit()</a></code> output object in the <code>model</code> component. When <code>distance</code> propensity score estimation method or a vector of distance values, the estimated or supplied distance measures will be included in the <code><a href="matchit.html">matchit()</a></code> output object in the <code>distance</code> component. Otherwise, the <code>distance</code> component will be empty.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>In versions of <em>MatchIt</em> prior to 4.0.0, <code>distance</code> was specified in a slightly different way. When specifying arguments using the old syntax, they will automatically be converted to the corresponding method in the new syntax but a warning will be thrown. <code>distance = "logit"</code>, the old default, will still work in the new syntax, though <code>distance = "glm", link = "logit"</code> is preferred (note that these are the default settings and don't need to be made explicit).</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Linearized probit regression PS:</span></span>
<span class="r-in"><span class="va">m.out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="st">"glm"</span>, link <span class="op">=</span> <span class="st">"linear.probit"</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># GAM logistic PS with smoothing splines (s()):</span></span>
<span class="r-in"><span class="va">m.out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">educ</span><span class="op">)</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.out2</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: quasibinomial </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function: logit </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat ~ s(age) + s(educ) + race + married + nodegree + re74 + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parametric coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  5.436e-01  3.950e-01   1.376  0.16923    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan  -2.447e+00  4.323e-01  -5.661 2.34e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite   -2.995e+00  3.136e-01  -9.552  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married     -1.643e+00  3.437e-01  -4.781 2.20e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     7.893e-01  4.800e-01   1.645  0.10060    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        -9.838e-05  3.245e-05  -3.031  0.00254 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         5.113e-05  5.001e-05   1.022  0.30706    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Approximate significance of smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           edf Ref.df     F p-value    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(age)  7.488  8.143 6.782  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(educ) 2.647  3.359 2.311  0.0628 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R-sq.(adj) =    0.5   Deviance explained = 46.1%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV = 0.69813  Scale est. = 1.0287    n = 614</span>
<span class="r-in"><span class="co"># CBPS for ATC matching w/replacement, using the just-</span></span>
<span class="r-in"><span class="co"># identified version of CBPS (setting method = "exact"):</span></span>
<span class="r-in"><span class="va">m.out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="st">"cbps"</span>, estimand <span class="op">=</span> <span class="st">"ATC"</span>,</span>
<span class="r-in">                  distance.options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span>,</span>
<span class="r-in">                  replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># Mahalanobis distance matching - no PS estimated</span></span>
<span class="r-in"><span class="va">m.out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="st">"mahalanobis"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">m.out4</span><span class="op">$</span><span class="va">distance</span> <span class="co">#NULL</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Mahalanobis distance matching with PS estimated</span></span>
<span class="r-in"><span class="co"># for use in a caliper; matching done on mahvars</span></span>
<span class="r-in"><span class="va">m.out5</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="st">"glm"</span>, caliper <span class="op">=</span> <span class="fl">.1</span>,</span>
<span class="r-in">                  mahvars <span class="op">=</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                                <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.out5</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matchit(formula = treat ~ age + educ + race + married + nodegree + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re74 + re75, data = lalonde, distance = "glm", mahvars = ~age + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     educ + race + married + nodegree + re74 + re75, caliper = 0.1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for All Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance          0.5774        0.1822          1.7941     0.9211    0.3774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.8162       28.0303         -0.3094     0.4400    0.0813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.3459       10.2354          0.0550     0.4959    0.0347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.8432        0.2028          1.7615          .    0.6404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0595        0.1422         -0.3498          .    0.0827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.0973        0.6550         -1.8819          .    0.5577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.1892        0.5128         -0.8263          .    0.3236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.7081        0.5967          0.2450          .    0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2095.5737     5619.2365         -0.7211     0.5181    0.2248</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1532.0553     2466.4844         -0.2903     0.9563    0.1342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance     0.6444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.1577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.6404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.5577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.3236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.4470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.2876</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for Matched Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance          0.5096        0.4916          0.0817     1.0782    0.0225</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.9459       25.3874          0.0781     0.4201    0.0869</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.4865       10.2883          0.0986     0.6448    0.0199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.7387        0.7207          0.0496          .    0.0180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0991        0.1171         -0.0762          .    0.0180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.1622        0.1622          0.0000          .    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.2072        0.2162         -0.0230          .    0.0090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.6486        0.6306          0.0396          .    0.0180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2667.1135     2357.0686          0.0634     1.7471    0.0387</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1811.2988     1506.3709          0.0947     1.9333    0.0253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max Std. Pair Dist.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance     0.1441          0.0922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.3063          0.9922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.0811          0.7707</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.0180          0.0496</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0180          0.0762</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.0000          0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.0090          0.4370</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.0180          0.4756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.2432          0.5712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.0901          0.5442</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All           429     185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matched       111     111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unmatched     318      74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Discarded       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># User-supplied propensity scores</span></span>
<span class="r-in"><span class="va">p.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                        <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                      family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">m.out6</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="va">p.score</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># User-supplied distance matrix using optmatch::match_on()</span></span>
<span class="r-in"><span class="va">dist_mat</span> <span class="op">&lt;-</span> <span class="fu">optmatch</span><span class="fu">::</span><span class="fu"><a href="https://markmfredrickson.github.io/optmatch/reference/match_on-methods.html" class="external-link">match_on</a></span><span class="op">(</span></span>
<span class="r-in">              <span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span>
<span class="r-in">                <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">              method <span class="op">=</span> <span class="st">"rank_mahalanobis"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">m.out7</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span>
<span class="r-in">                    <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span class="r-in">                  distance <span class="op">=</span> <span class="va">dist_mat</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniel Ho, Kosuke Imai, Gary King, Elizabeth Stuart, Noah Greifer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer></div>

  


  

  </body></html>

