<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Propensity scores and other distance measures — distance • MatchIt</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Propensity scores and other distance measures — distance"><meta name="description" content="Several matching methods require or can involve the distance between treated
and control units. Options include the Mahalanobis distance, propensity
score distance, or distance between user-supplied values. Propensity scores
are also used for common support via the discard options and for
defining calipers. This page documents the options that can be supplied to
the distance argument to matchit()."><meta property="og:description" content="Several matching methods require or can involve the distance between treated
and control units. Options include the Mahalanobis distance, propensity
score distance, or distance between user-supplied values. Propensity scores
are also used for common support via the discard options and for
defining calipers. This page documents the options that can be supplied to
the distance argument to matchit()."><meta property="og:image" content="https://kosukeimai.github.io/MatchIt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchIt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MatchIt.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/matching-methods.html">Matching Methods</a></li>
    <li><a class="dropdown-item" href="../articles/assessing-balance.html">Assessing Balance</a></li>
    <li><a class="dropdown-item" href="../articles/estimating-effects.html">Estimating Effects After Matching</a></li>
    <li><a class="dropdown-item" href="../articles/sampling-weights.html">Matching with Sampling Weights</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kosukeimai/MatchIt/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Propensity scores and other distance measures</h1>
      <small class="dont-index">Source: <a href="https://github.com/kosukeimai/MatchIt/blob/master/R/distance2_methods.R" class="external-link"><code>R/distance2_methods.R</code></a></small>
      <div class="d-none name"><code>distance.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Several matching methods require or can involve the distance between treated
and control units. Options include the Mahalanobis distance, propensity
score distance, or distance between user-supplied values. Propensity scores
are also used for common support via the <code>discard</code> options and for
defining calipers. This page documents the options that can be supplied to
the <code>distance</code> argument to <code><a href="matchit.html">matchit()</a></code>.</p>
    </div>


    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>In versions of <em>MatchIt</em> prior to 4.0.0, <code>distance</code> was specified in a
slightly different way. When specifying arguments using the old syntax, they
will automatically be converted to the corresponding method in the new syntax
but a warning will be thrown. <code>distance = "logit"</code>, the old default, will
still work in the new syntax, though <code>distance = "glm", link = "logit"</code> is
preferred (note that these are the default settings and don't need to be made
explicit).</p>
    </div>
    <div class="section level2">
    <h2 id="allowable-options">Allowable options<a class="anchor" aria-label="anchor" href="#allowable-options"></a></h2>



<p>There are four ways to specify the <code>distance</code> argument: 1) as a string containing the name of a method for
estimating propensity scores, 2) as a string containing the name of a method
for computing pairwise distances from the covariates, 3) as a vector of
values whose pairwise differences define the distance between units, or 4)
as a distance matrix containing all pairwise distances. The options are
detailed below.</p><div class="section">
<h3 id="propensity-score-estimation-methods">Propensity score estimation methods<a class="anchor" aria-label="anchor" href="#propensity-score-estimation-methods"></a></h3>


<p>When <code>distance</code> is specified as the name of a method for estimating propensity scores
(described below), a propensity score is estimated using the variables in
<code>formula</code> and the method corresponding to the given argument. This
propensity score can be used to compute the distance between units as the
absolute difference between the propensity scores of pairs of units.
Propensity scores can also be used to create calipers and common support
restrictions, whether or not they are used in the actual distance measure
used in the matching, if any.</p>
<p>In addition to the <code>distance</code> argument, two other arguments can be
specified that relate to the estimation and manipulation of the propensity
scores. The <code>link</code> argument allows for different links to be used in
models that require them such as generalized linear models, for which the
logit and probit links are allowed, among others. In addition to specifying
the link, the <code>link</code> argument can be used to specify whether the
propensity score or the linearized version of the propensity score should be
used; by specifying <code>link = "linear.{link}"</code>, the linearized version
will be used.</p>
<p>The <code>distance.options</code> argument can also be specified, which should be
a list of values passed to the propensity score-estimating function, for
example, to choose specific options or tuning parameters for the estimation
method. If <code>formula</code>, <code>data</code>, or <code>verbose</code> are not supplied
to <code>distance.options</code>, the corresponding arguments from
<code><a href="matchit.html">matchit()</a></code> will be automatically supplied. See the Examples for
demonstrations of the uses of <code>link</code> and <code>distance.options</code>. When
<code>s.weights</code> is supplied in the call to <code><a href="matchit.html">matchit()</a></code>, it will
automatically be passed to the propensity score-estimating function as the
<code>weights</code> argument unless otherwise described below.</p>
<p>The following methods for estimating propensity scores are allowed:</p>
<dl><dt><code>"glm"</code></dt>
<dd><p>The propensity scores are estimated using
a generalized linear model (e.g., logistic regression). The <code>formula</code>
supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>, and
<code><a href="https://rdrr.io/r/stats/predict.glm.html" class="external-link">predict.glm()</a></code> is used to compute the propensity scores. The <code>link</code>
argument can be specified as a link function supplied to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, e.g.,
<code>"logit"</code>, which is the default. When <code>link</code> is prepended by
<code>"linear."</code>, the linear predictor is used instead of the predicted
probabilities. <code>distance = "glm"</code> with <code>link = "logit"</code> (logistic
regression) is the default in <code><a href="matchit.html">matchit()</a></code>. (This used to be able to be requested as <code>distance = "ps"</code>, which still works.)</p></dd>

<dt><code>"gam"</code></dt>
<dd><p>The propensity scores are estimated using a generalized additive model. The
<code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to
mgcvgam, and mgcvpredict.gam is used to compute the propensity
scores. The <code>link</code> argument can be specified as a link function
supplied to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, e.g., <code>"logit"</code>, which is the default. When
<code>link</code> is prepended by <code>"linear."</code>, the linear predictor is used
instead of the predicted probabilities. Note that unless the smoothing
functions mgcvs, mgcvte, mgcvti, or mgcvt2 are
used in <code>formula</code>, a generalized additive model is identical to a
generalized linear model and will estimate the same propensity scores as
<code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>. See the documentation for mgcvgam,
mgcvformula.gam, and mgcvgam.models for more information on
how to specify these models. Also note that the formula returned in the
<code><a href="matchit.html">matchit()</a></code> output object will be a simplified version of the supplied
formula with smoothing terms removed (but all named variables present).</p></dd>

<dt><code>"gbm"</code></dt>
<dd><p>The propensity scores are estimated using a
generalized boosted model. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code>
is passed directly to gbmgbm, and gbmpredict.gbm is used to
compute the propensity scores. The optimal tree is chosen using 5-fold
cross-validation by default, and this can be changed by supplying an
argument to <code>method</code> to <code>distance.options</code>; see gbmgbm.perf
for details. The <code>link</code> argument can be specified as <code>"linear"</code> to
use the linear predictor instead of the predicted probabilities. No other
links are allowed. The tuning parameter defaults differ from
<code><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm::gbm()</a></code>; they are as follows: <code>n.trees = 1e4</code>,
<code>interaction.depth = 3</code>, <code>shrinkage = .01</code>, <code>bag.fraction = 1</code>, <code>cv.folds = 5</code>, <code>keep.data = FALSE</code>. These are the same
defaults as used in <em>WeightIt</em> and <em>twang</em>, except for
<code>cv.folds</code> and <code>keep.data</code>. Note this is not the same use of
generalized boosted modeling as in <em>twang</em>; here, the number of trees is
chosen based on cross-validation or out-of-bag error, rather than based on
optimizing balance. <span class="pkg">twang</span> should not be cited when using this method
to estimate propensity scores. Note that because there is a random component to choosing the tuning
parameter, results will vary across runs unless a <a href="https://rdrr.io/r/base/Random.html" class="external-link">seed</a> is
set.</p></dd>

<dt><code>"lasso"</code>, <code>"ridge"</code>, <code>"elasticnet"</code></dt>
<dd><p>The propensity
scores are estimated using a lasso, ridge, or elastic net model,
respectively. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is processed
with <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix()</a></code> and passed to glmnetcv.glmnet, and
glmnetpredict.cv.glmnet is used to compute the propensity scores. The
<code>link</code> argument can be specified as a link function supplied to
<code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial()</a></code>, e.g., <code>"logit"</code>, which is the default. When <code>link</code>
is prepended by <code>"linear."</code>, the linear predictor is used instead of
the predicted probabilities. When <code>link = "log"</code>, a Poisson model is
used. For <code>distance = "elasticnet"</code>, the <code>alpha</code> argument, which
controls how to prioritize the lasso and ridge penalties in the elastic net,
is set to .5 by default and can be changed by supplying an argument to
<code>alpha</code> in <code>distance.options</code>. For <code>"lasso"</code> and
<code>"ridge"</code>, <code>alpha</code> is set to 1 and 0, respectively, and cannot be
changed. The <code>cv.glmnet()</code> defaults are used to select the tuning
parameters and generate predictions and can be modified using
<code>distance.options</code>. If the <code>s</code> argument is passed to
<code>distance.options</code>, it will be passed to <code>predict.cv.glmnet()</code>.
Note that because there is a random component to choosing the tuning
parameter, results will vary across runs unless a <a href="https://rdrr.io/r/base/Random.html" class="external-link">seed</a> is
set.</p></dd>

<dt><code>"rpart"</code></dt>
<dd><p>The propensity scores are estimated using a
classification tree. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is
passed directly to rpartrpart, and rpartpredict.rpart is used
to compute the propensity scores. The <code>link</code> argument is ignored, and
predicted probabilities are always returned as the distance measure.</p></dd>

<dt><code>"randomforest"</code></dt>
<dd><p>The propensity scores are estimated using a
random forest. The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed
directly to randomForestrandomForest, and
randomForestpredict.randomForest is used to compute the propensity
scores. The <code>link</code> argument is ignored, and predicted probabilities are
always returned as the distance measure. Note that because there is a random component, results will vary across runs unless a <a href="https://rdrr.io/r/base/Random.html" class="external-link">seed</a> is
set.</p></dd>

<dt><code>"nnet"</code></dt>
<dd><p>The
propensity scores are estimated using a single-hidden-layer neural network.
The <code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to
nnetnnet, and <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> is used to compute the propensity scores.
The <code>link</code> argument is ignored, and predicted probabilities are always
returned as the distance measure. An argument to <code>size</code> must be
supplied to <code>distance.options</code> when using <code>method = "nnet"</code>.</p></dd>

<dt><code>"cbps"</code></dt>
<dd><p>The propensity scores are estimated using the
covariate balancing propensity score (CBPS) algorithm, which is a form of
logistic regression where balance constraints are incorporated to a
generalized method of moments estimation of of the model coefficients. The
<code>formula</code> supplied to <code><a href="matchit.html">matchit()</a></code> is passed directly to
CBPSCBPS, and <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> is used to compute the propensity
scores. The <code>link</code> argument can be specified as <code>"linear"</code> to use
the linear predictor instead of the predicted probabilities. No other links
are allowed. The <code>estimand</code> argument supplied to <code><a href="matchit.html">matchit()</a></code> will
be used to select the appropriate estimand for use in defining the balance
constraints, so no argument needs to be supplied to <code>ATT</code> in
<code>CBPS</code>.</p></dd>

<dt><code>"bart"</code></dt>
<dd><p>The propensity scores are estimated
using Bayesian additive regression trees (BART). The <code>formula</code> supplied
to <code><a href="matchit.html">matchit()</a></code> is passed directly to dbartsbart2,
and dbartsfitted.bart is used to compute the propensity
scores. The <code>link</code> argument can be specified as <code>"linear"</code> to use
the linear predictor instead of the predicted probabilities. When
<code>s.weights</code> is supplied to <code><a href="matchit.html">matchit()</a></code>, it will not be passed to
<code>bart2</code> because the <code>weights</code> argument in <code>bart2</code> does not
correspond to sampling weights. Note that because there is a random component to choosing the tuning
parameter, results will vary across runs unless the <code>seed</code> argument is supplied to <code>distance.options</code>. Note that setting a seed using <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> is not sufficient to guarantee reproducibility unless single-threading is used. See dbartsbart2 for details.</p></dd>


</dl></div>

<div class="section">
<h3 id="methods-for-computing-distances-from-covariates">Methods for computing distances from covariates<a class="anchor" aria-label="anchor" href="#methods-for-computing-distances-from-covariates"></a></h3>


<p>The following methods involve computing a distance matrix from the covariates
themselves without estimating a propensity score. Calipers on the distance
measure and common support restrictions cannot be used, and the <code>distance</code>
component of the output object will be empty because no propensity scores are
estimated. The <code>link</code> and <code>distance.options</code> arguments are ignored with these
methods. See the individual matching methods pages for whether these
distances are allowed and how they are used. Each of these distance measures
can also be calculated outside <code><a href="matchit.html">matchit()</a></code> using its <a href="mahalanobis_dist.html">corresponding function</a>.</p>
<dl><dt><code>"euclidean"</code></dt>
<dd><p>The Euclidean distance is the raw
distance between units, computed as $$d_{ij} = \sqrt{(x_i - x_j)(x_i - x_j)'}$$ It is sensitive to the scale of the covariates, so covariates with
larger scales will take higher priority.</p></dd>

<dt><code>"scaled_euclidean"</code></dt>
<dd><p>The scaled Euclidean distance is the
Euclidean distance computed on the scaled (i.e., standardized) covariates.
This ensures the covariates are on the same scale. The covariates are
standardized using the pooled within-group standard deviations, computed by
treatment group-mean centering each covariate before computing the standard
deviation in the full sample.</p></dd>

<dt><code>"mahalanobis"</code></dt>
<dd><p>The Mahalanobis distance is computed as $$d_{ij} = \sqrt{(x_i - x_j)\Sigma^{-1}(x_i - x_j)'}$$ where \(\Sigma\) is the pooled within-group
covariance matrix of the covariates, computed by treatment group-mean
centering each covariate before computing the covariance in the full sample.
This ensures the variables are on the same scale and accounts for the
correlation between covariates.</p></dd>

<dt><code>"robust_mahalanobis"</code></dt>
<dd><p>The
robust rank-based Mahalanobis distance is the Mahalanobis distance computed
on the ranks of the covariates with an adjustment for ties. It is described
in Rosenbaum (2010, ch. 8) as an alternative to the Mahalanobis distance
that handles outliers and rare categories better than the standard
Mahalanobis distance but is not affinely invariant.</p></dd>


</dl><p>To perform Mahalanobis distance matching <em>and</em> estimate propensity scores to
be used for a purpose other than matching, the <code>mahvars</code> argument should be
used along with a different specification to <code>distance</code>. See the individual
matching method pages for details on how to use <code>mahvars</code>.</p>
</div>

<div class="section">
<h3 id="distances-supplied-as-a-numeric-vector-or-matrix">Distances supplied as a numeric vector or matrix<a class="anchor" aria-label="anchor" href="#distances-supplied-as-a-numeric-vector-or-matrix"></a></h3>


<p><code>distance</code> can also be supplied as a numeric vector whose values will be
taken to function like propensity scores; their pairwise difference will
define the distance between units. This might be useful for supplying
propensity scores computed outside <code><a href="matchit.html">matchit()</a></code> or resupplying <code><a href="matchit.html">matchit()</a></code>
with propensity scores estimated previously without having to recompute them.</p>
<p><code>distance</code> can also be supplied as a matrix whose values represent the
pairwise distances between units. The matrix should either be a square, with
a row and column for each unit (e.g., as the output of a call to
<code>as.matrix(</code><code><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></code><code>(.))</code>), or have as many rows as there are treated units
and as many columns as there are control units (e.g., as the output of a call
to <code><a href="mahalanobis_dist.html">mahalanobis_dist()</a></code> or optmatchmatch_on). Distance values of
<code>Inf</code> will disallow the corresponding units to be matched. When <code>distance</code> is
a supplied as a numeric vector or matrix, <code>link</code> and <code>distance.options</code> are
ignored.</p>
</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Linearized probit regression PS:</span></span></span>
<span class="r-in"><span><span class="va">m.out1</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>                  link <span class="op">=</span> <span class="st">"linear.probit"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># GAM logistic PS with smoothing splines (s()):</span></span></span>
<span class="r-in"><span><span class="va">m.out2</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="fu">s</span><span class="op">(</span><span class="va">age</span><span class="op">)</span> <span class="op">+</span> <span class="fu">s</span><span class="op">(</span><span class="va">educ</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="st">"gam"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.out2</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: quasibinomial </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Link function: logit </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> treat ~ s(age) + s(educ) + race + married + nodegree + re74 + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re75</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parametric coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  5.436e-01  3.950e-01   1.376  0.16928    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan  -2.447e+00  4.323e-01  -5.661 2.34e-08 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite   -2.995e+00  3.136e-01  -9.552  &lt; 2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married     -1.644e+00  3.438e-01  -4.781 2.20e-06 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     7.894e-01  4.800e-01   1.645  0.10058    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74        -9.838e-05  3.245e-05  -3.031  0.00254 ** </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         5.113e-05  5.001e-05   1.022  0.30702    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Approximate significance of smooth terms:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           edf Ref.df     F p-value    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(age)  7.489  8.144 6.781  &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> s(educ) 2.647  3.359 2.311  0.0628 .  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> R-sq.(adj) =    0.5   Deviance explained = 46.1%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV = 0.69813  Scale est. = 1.0287    n = 614</span>
<span class="r-in"><span><span class="co"># CBPS for ATC matching w/replacement, using the just-</span></span></span>
<span class="r-in"><span><span class="co"># identified version of CBPS (setting method = "exact"):</span></span></span>
<span class="r-in"><span><span class="va">m.out3</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="st">"cbps"</span>,</span></span>
<span class="r-in"><span>                  estimand <span class="op">=</span> <span class="st">"ATC"</span>,</span></span>
<span class="r-in"><span>                  distance.options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"exact"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Mahalanobis distance matching - no PS estimated</span></span></span>
<span class="r-in"><span><span class="va">m.out4</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="st">"mahalanobis"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m.out4</span><span class="op">$</span><span class="va">distance</span> <span class="co">#NULL</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Mahalanobis distance matching with PS estimated</span></span></span>
<span class="r-in"><span><span class="co"># for use in a caliper; matching done on mahvars</span></span></span>
<span class="r-in"><span><span class="va">m.out5</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>                  caliper <span class="op">=</span> <span class="fl">.1</span>,</span></span>
<span class="r-in"><span>                  mahvars <span class="op">=</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                                <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.out5</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> matchit(formula = treat ~ age + educ + race + married + nodegree + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     re74 + re75, data = lalonde, distance = "glm", mahvars = ~age + </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     educ + race + married + nodegree + re74 + re75, caliper = 0.1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for All Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance          0.5774        0.1822          1.7941     0.9211    0.3774</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.8162       28.0303         -0.3094     0.4400    0.0813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.3459       10.2354          0.0550     0.4959    0.0347</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.8432        0.2028          1.7615          .    0.6404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0595        0.1422         -0.3498          .    0.0827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.0973        0.6550         -1.8819          .    0.5577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.1892        0.5128         -0.8263          .    0.3236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.7081        0.5967          0.2450          .    0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2095.5737     5619.2365         -0.7211     0.5181    0.2248</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1532.0553     2466.4844         -0.2903     0.9563    0.1342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance     0.6444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.1577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.6404</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0827</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.5577</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.3236</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.1114</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.4470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.2876</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of Balance for Matched Data:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            Means Treated Means Control Std. Mean Diff. Var. Ratio eCDF Mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance          0.5096        0.4916          0.0817     1.0782    0.0225</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age              25.9459       25.3874          0.0781     0.4201    0.0869</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ             10.4865       10.2883          0.0986     0.6448    0.0199</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack         0.7387        0.7207          0.0496          .    0.0180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan        0.0991        0.1171         -0.0762          .    0.0180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite         0.1622        0.1622          0.0000          .    0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married           0.2072        0.2162         -0.0230          .    0.0090</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree          0.6486        0.6306          0.0396          .    0.0180</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74           2667.1135     2357.0686          0.0634     1.7471    0.0387</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75           1811.2988     1506.3709          0.0947     1.9333    0.0253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eCDF Max Std. Pair Dist.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distance     0.1441          0.0922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age          0.3063          0.9922</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> educ         0.0811          0.7707</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> raceblack    0.0180          0.0496</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racehispan   0.0180          0.0762</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> racewhite    0.0000          0.0000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> married      0.0090          0.4370</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> nodegree     0.0180          0.4756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re74         0.2432          0.5712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> re75         0.0901          0.5442</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Sample Sizes:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           Control Treated</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> All           429     185</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Matched       111     111</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Unmatched     318      74</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Discarded       0       0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># User-supplied propensity scores</span></span></span>
<span class="r-in"><span><span class="va">p.score</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                        <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                      data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                      family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m.out6</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="va">p.score</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># User-supplied distance matrix using rank_mahalanobis()</span></span></span>
<span class="r-in"><span><span class="va">dist_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="mahalanobis_dist.html">robust_mahalanobis_dist</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>              <span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>              data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m.out7</span> <span class="op">&lt;-</span> <span class="fu"><a href="matchit.html">matchit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">nodegree</span> <span class="op">+</span></span></span>
<span class="r-in"><span>                    <span class="va">married</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span></span>
<span class="r-in"><span>                  data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                  distance <span class="op">=</span> <span class="va">dist_mat</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel Ho, Kosuke Imai, Gary King, Elizabeth Stuart, Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

